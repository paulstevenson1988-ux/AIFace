<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Static BLE Send to ESP32</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { font-family: sans-serif; padding: 20px; }
  button { padding: 10px 16px; font-size: 16px; }
  #log { white-space: pre-wrap; background: #f3f3f3; padding: 10px; margin-top: 20px; height: 200px; overflow-y: auto; }
</style>
</head>
<body>

<h1>Static BLE Send to ESP32</h1>
<p>Click the button to connect and send a test message.</p>
<button id="connectBtn">Connect & Send</button>

<div id="log"></div>

<script>
const NUS_SERVICE_UUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
const NUS_RX_UUID      = '6e400002-b5a3-f393-e0a9-e50e24dcca9e';
const NUS_TX_UUID      = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';

let rxChar, txChar;

function log(msg) {
  const logEl = document.getElementById('log');
  logEl.textContent += msg + '\n';
  logEl.scrollTop = logEl.scrollHeight;
  console.log(msg);
}

document.getElementById('connectBtn').addEventListener('click', async () => {
  log('Connect button clicked');
  try {
    let device;
    try {
      // Try with UUID filter first
      device = await navigator.bluetooth.requestDevice({
        filters: [{ services: [NUS_SERVICE_UUID] }],
        optionalServices: [NUS_SERVICE_UUID]
      });
    } catch {
      log('UUID filter found nothing, falling back to acceptAllDevices...');
      device = await navigator.bluetooth.requestDevice({
        acceptAllDevices: true,
        optionalServices: [NUS_SERVICE_UUID]
      });
    }

    log('Connecting to GATT server...');
    const server = await device.gatt.connect();

    log('Getting service...');
    const service = await server.getPrimaryService(NUS_SERVICE_UUID);

    log('Getting TX characteristic...');
    txChar = await service.getCharacteristic(NUS_TX_UUID);
    await txChar.startNotifications();
    txChar.addEventListener('characteristicvaluechanged', e => {
      const value = new TextDecoder().decode(e.target.value);
      log('TX notify: ' + value);
    });

    log('Getting RX characteristic...');
    rxChar = await service.getCharacteristic(NUS_RX_UUID);

    log('Connected! Sending static text...');
    const testData = 'HELLO_ESP32';
    await rxChar.writeValueWithoutResponse(new TextEncoder().encode(testData));
    log('Sent: ' + testData);

  } catch (error) {
    log('Error: ' + error);
  }
});
</script>

</body>
</html>
